define(["../cart.js","../dom/mainTbl.js","../tblUtils.js","../managers/total.js"],function(a,b,c,d){function e(a){var c=h(a),d=a.getCtorName()+(a.hasDiscount()?" coupon":"");return b.createRow(c,d)}function f(a){return b.insertChildToParent(a,n)}function g(a,c){switch(a){case"cart":return i(c);case"price":return c.hasDiscount()?b.createToolTippedCell("$"+c.getPrice().toFixed(2),"full price: "+c.getFullPrice(),a):b.createCell("$"+c.getPrice().toFixed(2),a);default:return b.createCell(c[a],a)}}function h(a){for(var b=[],c=0;c<m.length;c++)b.push(g(m[c],a));return b}function i(c){var d=a.getItemInChart(c.id),e=b.createCartLabel(d?d.qty:0),f=b.createCartAddRemoveButton(o.plus(c),e,"+"),g=b.createCartAddRemoveButton(o.minus(c),e,"-");return b.createCartCell(f,g,e)}function j(a,c){for(;c.hasNext();)b.insertChildToParent(a,e(c.next()));return a}function k(a){var c=b.getDetachedPlaceholder();f(c),j(c,a),b.reset(c)}function l(a){k(a)}var m=["id","name","desc","price","cart"],n=c.createHeadersRow(m),o={minus:function(b){return function(){var c=a.removeFromCart(b).qty.toString();return d.resetTotal(),c}},plus:function(b){return function(){var c=a.addToCart(b);return c.success?(d.resetTotal(),c.qty.toString()):void alert("can't sell you more or you'll get addicted!")}}};return{reset:k,init:l}});