define(["../items/itemsRepo.js","../errors.js","../managers/paging.js","../dom/coupon.js"],function(a,b,c,d){function e(b,c){if(b>1||0>b)throw new RangeError("Discount = "+b+". Must be between 0 and 1");j++,k[j]={discount:b,active:!1,itemsId:c};for(var d=0;d<c.length;d++){var e=a.getItemById(c[d]);e&&(e.coupons[j]={discount:b,active:!1})}return j}function f(d){if(!k[d])throw new b.CouponIdError(d+" isn't a valid coupon id");for(var e=a.getIterator();e.hasNext();)e.next().activateCoupon(d);return k[d].active=!0,c.repaint(),d}function g(a,b){return f(e(a,b))}function h(){g(.2,[0,3,6]),g(.1,[10,30,60]),g(.9,[15,25,27,65,69,102]),e(1,[10,19])}function i(){d.setBtnCouponActivatorListener(f)}var j=0,k={};return h(),i(),{createCoupon:e,activateCoupon:f,coupons:k,createAndActivateCoupon:g}});